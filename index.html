<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Perez's Book</title>
    <link rel="stylesheet" href="style.css" />
    <script src="env-config.js"></script>
  </head>
  <body>
    <div class="book-container">
      <div class="book">
        <div id="page-content" class="page">
          <p><strong>I Forgot how they call the part of the book where you talk about the author but yeah this is the part ~</strong></p>
          
          <p><strong>Author:</strong> Perez HABTAI (that's my actual character name in some game "thought it wasn't obvious when creating it")</p>
          
          <br>
          
          <p><strong>CAUTION‼ ~</strong>This book doesn't have a beginning so imagine you reach home and you find an mnet movie 30 mins in and it hooks you but then your mother sends you and you come back nga it has ended so now you keep trying to time it the next day it'll show but you don't know the exact date… (if you didn't experience this you…you need to touch some grass)</p>
          
          <p>~Man l just really hope you mfs get these references.</p>
          
          <p>~There is great misuse of this sign (…) great misuse!!!!</p>
          
          <p>~My only regret is that I know some of you won't get these references, comedy or not, and that I can't even explain them to you so well without killing the fun of getting a sick reference. Also I apologize for the fact that I underestimate some of you especially in this context but that's because you mfs be so slow sometimes. Infact so slow that I use that time you take, to remember Andruma and Sanya danced the same song(bellow eilish and Khalid one), same dance strokes, same climax dance move twice (some other Disney girl runs to towards the guy and they carry her in air on some dramatic shiii) and I cringe at all Disney movies so you can imagine how much I cringe thinking about this. Anyways I ain't hating on them, they just reminded me of how bad I hated Disney movies. To be specific Disney in general. Nickelodeon, CN, Boomerang(the one with tom and Jerry and Johny Bravo thing), Channel 44 ~ you'll soon find out as to why this is) then then Disney jr (Sofia the first man!) then Disney in that order.</p>
        </div>
        
        <div class="controls" id="main-controls">
          <button onclick="prevPage()" class="arrow-btn">◀</button>
          <span id="page-number" class="page-number">Page 1 of 5</span>
          <button onclick="nextPage()" class="arrow-btn">▶</button>
        </div>
        
        <div class="cover-controls" id="cover-controls" style="display: none;">
          <button onclick="nextPage()" class="arrow-btn">▶</button>
        </div>
        
        <div class="page-navigation">
          <button onclick="goToPage(1)" class="page-btn">Intro</button>
          <button onclick="goToPage(2)" class="page-btn">Ch. 0</button>
          <button onclick="goToPage(3)" class="page-btn">Ch. 1</button>
          <button onclick="goToPage(4)" class="page-btn">Ch. 2</button>
          <button onclick="goToPage(5)" class="page-btn">Ch. 3</button>
        </div>
      </div>
    </div>

    <script>
      // Check authentication status with server
      // Get API URL from environment or use default
      const API_URL = window.API_URL || 'http://localhost:3000';
      
      async function checkAuth() {
        try {
          const response = await fetch(`${API_URL}/profile`, {
            credentials: 'include'
          });
          
          if (response.ok) {
            const data = await response.json();
            localStorage.setItem('isLoggedIn', 'true');
            localStorage.setItem('userEmail', data.user.email);
            if (data.user.firstName && data.user.lastName) {
              localStorage.setItem('userName', data.user.firstName + ' ' + data.user.lastName);
            }
            console.log('Welcome back,', data.user.firstName || data.user.email);
          } else {
            // Token invalid or expired, redirect to login
            localStorage.removeItem('isLoggedIn');
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userName');
            window.location.href = 'loginp.html';
          }
        } catch (error) {
          console.error('Auth check error:', error);
          // Network error or server down, fallback to localStorage check
          if (!localStorage.getItem('isLoggedIn')) {
            window.location.href = 'loginp.html';
          }
        }
      }
      
      // Check authentication on page load
      checkAuth();
      
      // Add logout functionality
      async function logout() {
        try {
          await fetch(`${API_URL}/logout`, {
            method: 'POST',
            credentials: 'include'
          });
        } catch (error) {
          console.error('Logout error:', error);
        }
        
        localStorage.removeItem('isLoggedIn');
        localStorage.removeItem('userEmail');
        localStorage.removeItem('userName');
        window.location.href = 'loginp.html';
      }
      
      // Add logout button to the page
      window.addEventListener('DOMContentLoaded', () => {
        const logoutBtn = document.createElement('button');
        logoutBtn.textContent = 'Logout';
        logoutBtn.style.cssText = 'position: fixed; top: 10px; right: 10px; z-index: 1000; padding: 8px 16px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer;';
        logoutBtn.onclick = logout;
        document.body.appendChild(logoutBtn);
      });
    </script>
    <script src="script.js"></script>
  </body>
</html>
